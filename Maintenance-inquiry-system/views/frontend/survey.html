<!DOCTYPE html>
<html lang="zh-Hant">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>滿意度調查</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="assets/css/styles.css">
</head>

<body>
    <div class="container mt-5">
        <h2 class="text-center mb-4">滿意度調查</h2>
        <div id="survey-list" class="list-group mb-4">
            <!-- 調查項目將通過 JavaScript 插入 -->
        </div>
    </div>

    <script src="assets/js/common.js"></script>
    <script>
        function loadSurveyList() {
            ajaxRequest('/api/surveys/get.php', 'GET', null, function (surveys) {
                const surveyList = document.getElementById('survey-list');
                surveyList.innerHTML = '';
                surveys.forEach(survey => {
                    const item = document.createElement('div');
                    item.className = 'list-group-item';
                    item.innerHTML = `
                        <h5>服務項目: ${survey.service_name}</h5>
                        <label>評分:</label>
                        <select onchange="submitRating(${survey.id}, this.value)">
                            ${[1, 2, 3, 4, 5].map(r => `
                                <option value="${r}" ${survey.rating == r ? 'selected' : ''}>${r}</option>
                            `).join('')}
                        </select>
                        <div class="mt-2">
                            <label>反饋:</label>
                            <textarea onchange="submitFeedback(${survey.id}, this.value)" class="form-control">${survey.feedback || ''}</textarea>
                        </div>`;
                    surveyList.appendChild(item);
                });
            });
        }

        function submitRating(surveyId, rating) {
            ajaxRequest(`/api/surveys/rate.php?id=${surveyId}`, 'POST', { rating }, response => {
                alert(response.success ? "評分提交成功" : "評分提交失敗");
            });
        }

        function submitFeedback(surveyId, feedback) {
            ajaxRequest(`/api/surveys/feedback.php?id=${surveyId}`, 'POST', { feedback }, response => {
                alert(response.success ? "反饋提交成功" : "反饋提交失敗");
            });
        }

        document.addEventListener('DOMContentLoaded', loadSurveyList);
    </script>
</body>

</html>
